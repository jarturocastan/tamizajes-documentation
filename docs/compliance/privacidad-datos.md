# Privacidad y Protecci√≥n de Datos

## Introducci√≥n

El Sistema UNEME-CECOSAMA maneja informaci√≥n m√©dica altamente sensible que requiere el m√°s alto nivel de protecci√≥n y cumplimiento con normativas nacionales e internacionales de privacidad de datos m√©dicos.

## Marco Normativo Aplicable

### üá≤üáΩ Normativa Mexicana

=== "Ley Federal de Protecci√≥n de Datos Personales (LFPDPPP)"
    **Aplicabilidad**: Sector p√∫blico mexicano
    
    **Principios Fundamentales**:
    - **Licitud**: Tratamiento conforme a ley
    - **Finalidad**: Uso espec√≠fico y determinado
    - **Lealtad**: Tratamiento conforme a expectativas del titular
    - **Consentimiento**: Autorizaci√≥n del titular
    - **Calidad**: Datos exactos, completos y actualizados
    - **Proporcionalidad**: Datos necesarios para la finalidad
    - **Informaci√≥n**: Transparencia en el tratamiento
    - **Responsabilidad**: Garantizar cumplimiento normativo

=== "Ley General de Salud - NOM-024-SSA3-2012"
    **Aplicabilidad**: Sistemas de informaci√≥n en salud
    
    **Requisitos Espec√≠ficos**:
    - Confidencialidad de informaci√≥n cl√≠nica
    - Consentimiento informado documentado
    - Acceso restringido por niveles de autorizaci√≥n
    - Auditor√≠a de accesos a expedientes
    - Backup y recuperaci√≥n de informaci√≥n m√©dica

=== "Normas de la Secretar√≠a de Salud"
    **NOM-004-SSA3-2012**: Expediente cl√≠nico
    **NOM-024-SSA3-2012**: Sistemas de informaci√≥n
    **NOM-025-SSA3-2013**: Organizaci√≥n y funcionamiento

### üåç Est√°ndares Internacionales

=== "GDPR - Reglamento General de Protecci√≥n de Datos"
    **Aplicabilidad**: Si se procesan datos de ciudadanos europeos
    
    **Principios Clave**:
    - Derecho al olvido
    - Portabilidad de datos
    - Notificaci√≥n de brechas en 72 horas
    - Designaci√≥n de Data Protection Officer (DPO)
    - Privacy by Design

=== "HIPAA - Health Insurance Portability and Accountability Act"
    **Aplicabilidad**: Est√°ndares de referencia internacional
    
    **Controles T√©cnicos**:
    - Cifrado de datos en tr√°nsito y reposo
    - Control de acceso basado en roles
    - Logs de auditor√≠a exhaustivos
    - Backup seguro y recuperaci√≥n

## Clasificaci√≥n de Datos

### üîí Tipos de Datos y Niveles de Protecci√≥n

| Categor√≠a | Tipo de Datos | Nivel de Protecci√≥n | Acceso Autorizado |
|-----------|--------------|-------------------|------------------|
| **Datos Identificativos** | Nombre, CURP, tel√©fono, direcci√≥n | Alto | Personal m√©dico asignado |
| **Datos Cl√≠nicos** | PHQ-9, AUDIT, diagn√≥sticos, tratamientos | Cr√≠tico | Profesional tratante + supervisor |
| **Datos Sensibles** | Ideaci√≥n suicida, adicciones, violencia | M√°ximo | Profesional + coordinador m√©dico |
| **Datos de Contacto** | Familiares, emergencia, referencias | Alto | Personal m√©dico + administrativo |
| **Datos del Sistema** | Logs, m√©tricas, uso del sistema | Medio | Administradores t√©cnicos |

### üìä Matriz de Acceso por Rol

```mermaid
graph TB
    subgraph "Datos del Paciente"
        A[Informaci√≥n Personal]
        B[Datos Cl√≠nicos] 
        C[Informaci√≥n Sensible]
        D[Contactos de Emergencia]
    end
    
    subgraph "Roles de Usuario"
        E[Psic√≥logo Asignado]
        F[Coordinador M√©dico]
        G[Recepcionista]
        H[Administrador]
        I[Auditor]
    end
    
    E --> A
    E --> B
    E --> C
    E --> D
    
    F --> A
    F --> B
    F --> C
    F --> D
    
    G --> A
    G --> D
    
    H --> A
    H --> B
    
    I --> A
    I --> B
    I --> C
    
    classDef sensitive fill:#ffcdd2,stroke:#d32f2f
    classDef clinical fill:#fff3e0,stroke:#f57c00
    classDef personal fill:#e3f2fd,stroke:#1976d2
    classDef admin fill:#f3e5f5,stroke:#7b1fa2
    
    class C sensitive
    class B clinical
    class A,D personal
    class H,I admin
```

## Controles T√©cnicos de Seguridad

### üîê Cifrado y Protecci√≥n de Datos

=== "Cifrado en Tr√°nsito"
    **TLS 1.3 Obligatorio**
    ```nginx
    # Configuraci√≥n Nginx para HTTPS
    server {
        listen 443 ssl http2;
        ssl_protocols TLSv1.3;
        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
        ssl_prefer_server_ciphers off;
        ssl_session_cache shared:SSL:10m;
        
        # HSTS Header
        add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";
        
        # Security Headers
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header Referrer-Policy "strict-origin-when-cross-origin";
    }
    ```

=== "Cifrado en Reposo"
    **AES-256 para Base de Datos**
    ```sql
    -- Configuraci√≥n MySQL para cifrado
    SET GLOBAL innodb_encryption_rotate_key_age = 1;
    SET GLOBAL innodb_encryption_threads = 4;
    
    -- Crear tabla con cifrado
    CREATE TABLE patient_data (
        id INT PRIMARY KEY,
        sensitive_data JSON,
        created_at TIMESTAMP
    ) ENCRYPTION='Y';
    ```

=== "Gesti√≥n de Claves"
    ```yaml
    # Configuraci√≥n de gesti√≥n de claves
    encryption:
      key_management:
        provider: "AWS KMS"  # o equivalente local
        key_rotation: "90_days"
        backup_keys: "encrypted_multiple_locations"
        access_control: "role_based"
    ```

### üõ°Ô∏è Control de Acceso

=== "Autenticaci√≥n Multi-Factor"
    ```javascript
    // Implementaci√≥n 2FA obligatorio
    const authenticationPolicy = {
        mfa_required: true,
        mfa_methods: ['SMS', 'authenticator_app', 'email'],
        session_timeout: 30, // minutos
        password_policy: {
            min_length: 12,
            require_uppercase: true,
            require_lowercase: true,
            require_numbers: true,
            require_symbols: true,
            password_history: 12,
            max_attempts: 3
        }
    };
    ```

=== "Control de Acceso Basado en Roles (RBAC)"
    ```json
    {
      "roles": {
        "psicologo_clinico": {
          "permissions": [
            "read_patient_basic",
            "read_patient_clinical",
            "write_session_notes",
            "update_treatment_plan"
          ],
          "data_scope": "assigned_patients_only"
        },
        "coordinador_medico": {
          "permissions": [
            "read_all_patients",
            "assign_professionals", 
            "access_crisis_alerts",
            "generate_reports"
          ],
          "data_scope": "all_patients"
        },
        "auditor": {
          "permissions": [
            "read_audit_logs",
            "read_patient_anonymized",
            "generate_compliance_reports"
          ],
          "data_scope": "audit_data_only"
        }
      }
    }
    ```

### üìù Auditor√≠a y Logs

=== "Logging Obligatorio"
    ```javascript
    // Sistema de auditor√≠a completo
    function logDataAccess(action, userId, patientId, dataType, ipAddress) {
        const auditLog = {
            timestamp: new Date().toISOString(),
            action: action, // 'READ', 'WRITE', 'UPDATE', 'DELETE'
            user_id: userId,
            user_role: getUserRole(userId),
            patient_id: patientId,
            data_type: dataType,
            ip_address: ipAddress,
            session_id: getSessionId(),
            success: true,
            risk_level: calculateRiskLevel(action, dataType)
        };
        
        // Almacenar en sistema de auditor√≠a inmutable
        auditDatabase.insertImmutable(auditLog);
        
        // Alertas para acciones de alto riesgo
        if (auditLog.risk_level === 'HIGH') {
            sendSecurityAlert(auditLog);
        }
    }
    ```

=== "Monitoreo en Tiempo Real"
    ```yaml
    # Configuraci√≥n de alertas de seguridad
    security_monitoring:
      alerts:
        - name: "M√∫ltiples accesos fallidos"
          condition: "failed_logins > 5 in 10_minutes"
          action: "block_ip_and_notify_admin"
        
        - name: "Acceso fuera de horario"
          condition: "access_time NOT BETWEEN 06:00 AND 22:00"
          action: "require_additional_authentication"
        
        - name: "Descarga masiva de datos"
          condition: "data_export > 100_records in 1_hour"
          action: "block_action_and_notify_security"
        
        - name: "Acceso desde ubicaci√≥n inusual"
          condition: "ip_geolocation NOT IN approved_regions"
          action: "require_manager_approval"
    ```

## Consentimiento Informado Digital

### üìú Formulario de Consentimiento

=== "Consentimiento Completo"
    ```html
    <div class="informed-consent">
        <h2>üìã Consentimiento Informado para Tratamiento Digital</h2>
        
        <div class="consent-section">
            <h3>1. Tratamiento de Datos Personales</h3>
            <p>Acepto que UNEME-CECOSAMA procese mis datos personales y de salud para:</p>
            <ul>
                <li>‚úÖ Brindar atenci√≥n m√©dica y psicol√≥gica especializada</li>
                <li>‚úÖ Comunicaci√≥n relacionada con mi tratamiento</li>
                <li>‚úÖ Seguimiento de mi evoluci√≥n cl√≠nica</li>
                <li>‚úÖ Generaci√≥n de reportes estad√≠sticos anonimizados</li>
            </ul>
        </div>
        
        <div class="consent-section">
            <h3>2. Medios de Comunicaci√≥n Digital</h3>
            <label>
                <input type="checkbox" required>
                Autorizo recibir comunicaci√≥n v√≠a WhatsApp para:
                <ul>
                    <li>Recordatorios de citas</li>
                    <li>Env√≠o de formularios de evaluaci√≥n</li>
                    <li>Seguimiento de tratamiento</li>
                </ul>
            </label>
        </div>
        
        <div class="consent-section">
            <h3>3. Informaci√≥n Sensible</h3>
            <label>
                <input type="checkbox" required>
                Entiendo que en caso de detectarse riesgo para mi seguridad, 
                el equipo m√©dico podr√° contactar a mis familiares o autoridades 
                competentes para garantizar mi bienestar.
            </label>
        </div>
        
        <div class="consent-section">
            <h3>4. Derechos del Titular</h3>
            <p>Conozco mis derechos ARCO (Acceso, Rectificaci√≥n, Cancelaci√≥n, Oposici√≥n):</p>
            <ul>
                <li>üìß Contacto: privacidad@uneme-cecosama.gob.mx</li>
                <li>üìû Tel√©fono: [PENDIENTE - VALIDAR]</li>
                <li>üè¢ Oficina de Atenci√≥n a Usuarios</li>
            </ul>
        </div>
        
        <div class="final-consent">
            <label>
                <input type="checkbox" required>
                <strong>He le√≠do, entendido y acepto este consentimiento informado</strong>
            </label>
            
            <div class="signature-section">
                <p>Firma Digital: <span id="digital-signature"></span></p>
                <p>Fecha: <span id="consent-date"></span></p>
                <p>IP Address: <span id="ip-address"></span></p>
            </div>
        </div>
    </div>
    ```

=== "Para Menores de Edad"
    ```html
    <div class="minor-consent">
        <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Consentimiento para Menores de Edad</h3>
        
        <div class="parent-info">
            <h4>Datos del Padre/Madre/Tutor:</h4>
            <input type="text" placeholder="Nombre completo" required>
            <input type="text" placeholder="Parentesco" required>
            <input type="tel" placeholder="Tel√©fono" required>
            <input type="email" placeholder="Email" required>
        </div>
        
        <div class="minor-assent">
            <h4>üßí Asentimiento del Menor:</h4>
            <label>
                <input type="checkbox" required>
                Entiendo que voy a recibir ayuda m√©dica y que mis pap√°s 
                han dado permiso para que me traten aqu√≠.
            </label>
        </div>
        
        <div class="parent-consent">
            <label>
                <input type="checkbox" required>
                Como padre/madre/tutor legal, autorizo el tratamiento 
                de los datos personales y de salud de mi hijo/a menor de edad.
            </label>
        </div>
    </div>
    ```

## Retenci√≥n y Eliminaci√≥n de Datos

### üóÇÔ∏è Pol√≠tica de Retenci√≥n

| Tipo de Dato | Per√≠odo de Retenci√≥n | Criterio de Eliminaci√≥n | M√©todo de Eliminaci√≥n |
|---------------|-------------------|----------------------|---------------------|
| **Expediente Cl√≠nico** | 7 a√±os post-alta | Requerimiento legal | Eliminaci√≥n segura certificada |
| **Datos de Contacto** | 3 a√±os post-inactividad | Inactividad del paciente | Anonimizaci√≥n |
| **Logs de Auditor√≠a** | 5 a√±os | Cumplimiento normativo | Archivo seguro offline |
| **Datos de WhatsApp** | 1 a√±o | Finalizaci√≥n de tratamiento | Eliminaci√≥n autom√°tica |
| **Reportes Estad√≠sticos** | Indefinido | Datos anonimizados | No aplicable |

### üîÑ Proceso de Eliminaci√≥n Segura

```javascript
// Proceso automatizado de eliminaci√≥n
class SecureDataDeletion {
    async deletePatientData(patientId, deletionReason) {
        const deletionLog = {
            patient_id: patientId,
            deletion_date: new Date(),
            reason: deletionReason,
            authorized_by: getCurrentUser(),
            data_types_deleted: []
        };
        
        // 1. Verificar per√≠odo de retenci√≥n cumplido
        const retentionCheck = await this.verifyRetentionPeriod(patientId);
        if (!retentionCheck.canDelete) {
            throw new Error(`Retention period not met: ${retentionCheck.reason}`);
        }
        
        // 2. Crear backup para auditor√≠a
        await this.createAuditBackup(patientId);
        
        // 3. Eliminaci√≥n en cascada
        const deletedData = await this.cascadeDelete(patientId);
        deletionLog.data_types_deleted = deletedData;
        
        // 4. Sobrescritura segura (DoD 5220.22-M)
        await this.secureOverwrite(deletedData.fileLocations);
        
        // 5. Registro inmutable de eliminaci√≥n
        await this.logDeletion(deletionLog);
        
        return deletionLog;
    }
    
    async secureOverwrite(fileLocations) {
        // Implementar est√°ndar DoD 5220.22-M
        // 3 pasadas de sobrescritura
        for (const location of fileLocations) {
            await this.overwritePass(location, '0x00'); // Paso 1: ceros
            await this.overwritePass(location, '0xFF'); // Paso 2: unos
            await this.overwritePass(location, 'random'); // Paso 3: aleatorio
        }
    }
}
```

## Transferencia Internacional de Datos

### üåç Consideraciones para Transferencias

=== "Evaluaci√≥n de Adecuaci√≥n"
    ```javascript
    const internationalTransferPolicy = {
        allowed_countries: [
            'Canada', // Decisi√≥n de adecuaci√≥n
            'Switzerland', // Decisi√≥n de adecuaci√≥n
            'Argentina' // Decisi√≥n de adecuaci√≥n
        ],
        
        transfer_mechanisms: {
            adequacy_decision: 'preferred',
            standard_contractual_clauses: 'backup_option',
            binding_corporate_rules: 'not_applicable'
        },
        
        prohibited_countries: [
            // Pa√≠ses sin protecci√≥n adecuada
            'China', 'Russia', // Por pol√≠ticas de datos
        ],
        
        data_localization: {
            patient_data: 'mexico_only',
            audit_logs: 'mexico_only',
            statistical_reports: 'transfer_allowed'
        }
    };
    ```

=== "Contratos de Transferencia"
    ```yaml
    # Cl√°usulas contractuales est√°ndar
    transfer_contract:
      data_controller: "UNEME-CECOSAMA"
      data_processor: "[Proveedor externo]"
      
      obligations:
        - "Procesar datos solo seg√∫n instrucciones"
        - "Implementar medidas t√©cnicas apropiadas"
        - "Notificar brechas en 24 horas"
        - "Retornar/eliminar datos al t√©rmino"
        - "Permitir auditor√≠as de cumplimiento"
      
      liability:
        - "Responsabilidad solidaria por da√±os"
        - "Seguro de responsabilidad civil"
        - "Indemnizaci√≥n por incumplimiento"
    ```

## Gesti√≥n de Incidentes de Seguridad

### üö® Procedimiento de Respuesta a Incidentes

=== "Clasificaci√≥n de Incidentes"
    ```javascript
    const incidentClassification = {
        CRITICAL: {
            description: "Exposici√≥n de datos m√©dicos sensibles",
            response_time: "1 hora",
            notification_required: ["authorities", "patients", "media"],
            example: "Base de datos m√©dica comprometida"
        },
        
        HIGH: {
            description: "Acceso no autorizado a datos personales",
            response_time: "4 horas", 
            notification_required: ["authorities", "patients"],
            example: "Empleado accede datos fuera de autorizaci√≥n"
        },
        
        MEDIUM: {
            description: "Vulnerabilidad t√©cnica identificada",
            response_time: "24 horas",
            notification_required: ["management"],
            example: "Fallo en sistema de autenticaci√≥n"
        },
        
        LOW: {
            description: "Incidente menor sin exposici√≥n",
            response_time: "72 horas",
            notification_required: ["IT_team"],
            example: "Error en logs de auditor√≠a"
        }
    };
    ```

=== "Plan de Respuesta"
    ```mermaid
    flowchart TD
        A[Detecci√≥n de Incidente] --> B{Clasificar Severidad}
        B -->|Cr√≠tico| C[Activar Equipo de Crisis]
        B -->|Alto| D[Notificar Coordinador]
        B -->|Medio/Bajo| E[Asignar a IT]
        
        C --> F[Contener Amenaza Inmediatamente]
        D --> G[Evaluar Impacto]
        E --> H[Investigar y Documentar]
        
        F --> I[Notificar Autoridades < 24h]
        G --> J[Implementar Controles]
        H --> K[Aplicar Correcciones]
        
        I --> L[Comunicar a Pacientes Afectados]
        J --> M[Monitorear Resoluci√≥n]
        K --> N[Actualizar Procedimientos]
        
        L --> O[Reporte Final]
        M --> O
        N --> O
    ```

### üìä M√©tricas de Cumplimiento

| M√©trica | Objetivo | Frecuencia de Medici√≥n | Responsable |
|---------|----------|----------------------|-------------|
| **Tiempo de Detecci√≥n** | < 4 horas | Continuo | SOC Team |
| **Tiempo de Contenci√≥n** | < 1 hora (cr√≠tico) | Por incidente | CISO |
| **Completitud de Logs** | 100% | Diario | Auditor |
| **Capacitaci√≥n del Personal** | 100% anual | Trimestral | RRHH |
| **Auditor√≠as Externas** | Sin hallazgos cr√≠ticos | Anual | Direcci√≥n |

---

## Checklist de Cumplimiento

### ‚úÖ Implementaci√≥n T√©cnica
- [ ] Cifrado TLS 1.3 implementado
- [ ] Base de datos cifrada (AES-256)
- [ ] Autenticaci√≥n multi-factor obligatoria
- [ ] Logs de auditor√≠a completos
- [ ] Backup cifrado y seguro

### ‚úÖ Procedimientos Operativos
- [ ] Pol√≠tica de privacidad publicada
- [ ] Consentimientos informados digitales
- [ ] Procedimiento de derechos ARCO
- [ ] Plan de respuesta a incidentes
- [ ] Capacitaci√≥n del personal

### ‚úÖ Cumplimiento Legal
- [ ] Registro en SNPDP (si aplica)
- [ ] Contratos con procesadores
- [ ] Evaluaciones de impacto realizadas
- [ ] Documentaci√≥n de cumplimiento
- [ ] Auditor√≠as programadas

!!! danger "Responsabilidad Institucional"
    El cumplimiento de privacidad de datos es responsabilidad institucional. Cualquier incumplimiento puede resultar en sanciones legales, p√©rdida de confianza y da√±o reputacional.

!!! tip "Mejora Continua"
    Revisar y actualizar pol√≠ticas de privacidad cada 6 meses o cuando cambien las normativas aplicables.

!!! warning "Validaciones Pendientes"
    **[PENDIENTE - VALIDAR CON CLIENTE]**:
    - Contacto espec√≠fico para ejercicio de derechos ARCO
    - Procedimientos internos de la instituci√≥n
    - Autoridad de control espec√≠fica regional
    - Requisitos adicionales de la Secretar√≠a de Salud local